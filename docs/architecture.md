# 架构文档

## 项目结构

```
boniu-crawler/
├── src/                          # 源代码
│   ├── crawler/                  # 爬虫核心包
│   │   ├── core/                 # 核心模块
│   │   │   ├── base.py           # 基础爬虫类
│   │   │   └── requests_impl.py  # Requests实现
│   │   ├── sites/                 # 站点特定爬虫
│   │   │   └── boniu/            # 博牛爬虫
│   │   ├── utils/                # 工具模块
│   │   │   ├── parser.py         # 解析工具
│   │   │   ├── storage.py        # 存储工具
│   │   │   ├── anti_detect.py    # 反检测工具
│   │   │   └── http.py           # HTTP工具
│   │   └── config/               # 配置模块
│   │       └── settings.py       # 配置管理
│   └── cli/                      # 命令行接口
│       └── main.py               # CLI主入口
├── tests/                        # 测试目录
│   ├── unit/                     # 单元测试
│   ├── integration/              # 集成测试
│   └── fixtures/                 # 测试数据
├── data/                         # 数据目录
│   ├── raw/                      # 原始数据
│   ├── processed/                # 处理后数据
│   ├── exports/                  # 导出数据
│   └── cache/                    # 缓存数据
├── config/                       # 配置文件
│   ├── development.yaml          # 开发环境配置
│   ├── production.yaml           # 生产环境配置
│   └── sites/                    # 站点配置
│       └── boniu.yaml            # 博牛站点配置
├── docs/                         # 文档目录
├── logs/                         # 日志目录
└── scripts/                      # 脚本目录
```

## 核心架构

### 1. 分层架构

- **表现层**: CLI命令行接口
- **业务层**: 爬虫核心逻辑
- **数据层**: 数据存储和处理
- **工具层**: 通用工具函数

### 2. 模块化设计

- **核心模块**: 提供基础爬虫功能
- **站点模块**: 特定站点的爬虫实现
- **工具模块**: 可复用的工具函数
- **配置模块**: 统一的配置管理

### 3. 设计模式

- **模板方法模式**: BaseCrawler定义爬虫流程
- **策略模式**: 不同的爬虫实现策略
- **工厂模式**: 爬虫实例创建
- **单例模式**: 配置管理

## 数据流

```
用户输入 → CLI → 爬虫实例 → 网络请求 → 数据解析 → 数据存储 → 输出结果
```

## 扩展性

### 添加新站点爬虫

1. 在 `src/crawler/sites/` 下创建新目录
2. 实现继承自 `RequestsCrawler` 的爬虫类
3. 在 `src/crawler/__init__.py` 中导出
4. 添加站点配置文件

### 添加新工具

1. 在 `src/crawler/utils/` 下创建新模块
2. 实现工具函数
3. 在 `src/crawler/utils/__init__.py` 中导出

## 配置管理

- 使用 Pydantic 进行配置验证
- 支持环境变量覆盖
- 支持 YAML 配置文件
- 支持不同环境配置

## 错误处理

- 统一的异常处理机制
- 自动重试功能
- 详细的错误日志
- 优雅的错误恢复

## 性能优化

- 连接池复用
- 异步支持
- 批量处理
- 缓存机制
